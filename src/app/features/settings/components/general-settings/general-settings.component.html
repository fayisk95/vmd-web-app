<div class="general-settings-container">
  <div class="section-header">
    <h2>General Settings</h2>
    <p>Configure basic application settings including currency and tax rates</p>
  </div>

  <form [formGroup]="generalForm" (ngSubmit)="onSubmit()" class="general-form">
    <div class="form-section">
      <h3>Currency Settings</h3>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Default Currency</mat-label>
          <mat-select formControlName="currency">
            <mat-option *ngFor="let currency of availableCurrencies" [value]="currency.code">
              <div class="currency-option">
                <span class="currency-symbol">{{ currency.symbol }}</span>
                <span class="currency-name">{{ currency.name }}</span>
                <span class="currency-code">({{ currency.code }})</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-hint>This currency will be used throughout the application</mat-hint>
          <mat-error>{{ getFieldError('currency') }}</mat-error>
        </mat-form-field>
      </div>

      <div class="currency-preview" *ngIf="generalForm.get('currency')?.value">
        <div class="preview-item">
          <span class="label">Sample Amount:</span>
          <span class="value">
            {{ selectedCurrencySymbol }}1,234.56
          </span>
        </div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="form-section">
      <h3>Tax Settings</h3>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Default Tax Rate</mat-label>
          <input matInput type="number" formControlName="defaultTaxRate" min="0" max="100" step="0.01"
            placeholder="10.00">
          <span matSuffix>%</span>
          <mat-hint>Default tax rate applied to invoices (0-100%)</mat-hint>
          <mat-error>{{ getFieldError('defaultTaxRate') }}</mat-error>
        </mat-form-field>
      </div>

      <div class="tax-preview" *ngIf="generalForm.get('defaultTaxRate')?.value">
        <div class="preview-calculation">
          <div class="calc-row">
            <span class="label">Subtotal:</span>
            <span class="value">{{ selectedCurrencySymbol }}100.00</span>
          </div>
          <div class="calc-row">
            <span class="label">Tax ({{ generalForm.get('defaultTaxRate')?.value }}%):</span>
            <span class="value">{{ selectedCurrencySymbol }}{{ (100 * (generalForm.get('defaultTaxRate')?.value || 0) / 100).toFixed(2) }}</span>
          </div>
          <div class="calc-row total">
            <span class="label">Total:</span>
            <span class="value">{{ selectedCurrencySymbol }}{{ (100 + (100 * (generalForm.get('defaultTaxRate')?.value || 0) / 100)).toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button mat-button type="button" (click)="onReset()" [disabled]="loading">
        Reset
      </button>
      <button mat-raised-button color="primary" type="submit"
        [disabled]="loading || generalForm.invalid || !generalForm.dirty">
        <mat-icon *ngIf="loading" class="spinning">refresh</mat-icon>
        <span *ngIf="!loading">Save Changes</span>
        <span *ngIf="loading">Saving...</span>
      </button>
    </div>
  </form>
</div>