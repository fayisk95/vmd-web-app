<div class="trip-count-report-container">
  <div *ngIf="loading" class="loading-container">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <div *ngIf="!loading" class="report-content">
    <!-- View Toggle -->
    <mat-card class="view-toggle-card">
      <mat-card-content>
        <mat-button-toggle-group [(value)]="selectedView" (change)="onViewChange($event.value)">
          <mat-button-toggle value="vehicle">By Vehicle</mat-button-toggle>
          <mat-button-toggle value="client">By Client</mat-button-toggle>
        </mat-button-toggle-group>
      </mat-card-content>
    </mat-card>

    <!-- Summary Stats -->
    <div class="summary-stats">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon">
              <mat-icon>local_shipping</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ getTotalTrips() }}</div>
              <div class="stat-label">Total Trips</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon">
              <mat-icon>attach_money</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ getTotalRevenue() | currencyFormat }}</div>
              <div class="stat-label">Total Revenue</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon">
              <mat-icon>{{ selectedView === 'vehicle' ? 'directions_bus' : 'people' }}</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ getCurrentData().length }}</div>
              <div class="stat-label">{{ selectedView === 'vehicle' ? 'Vehicles' : 'Clients' }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <mat-card class="chart-card" *ngIf="selectedView === 'vehicle'">
        <mat-card-header>
          <mat-card-title>Trip Distribution by Vehicle</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-wrapper">
            <canvas #vehicleChart></canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card" *ngIf="selectedView === 'client'">
        <mat-card-header>
          <mat-card-title>Trip Count by Client</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-wrapper">
            <canvas #clientChart></canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Data Table -->
      <mat-card class="table-card">
        <mat-card-header>
          <mat-card-title>{{ selectedView === 'vehicle' ? 'Vehicle' : 'Client' }} Breakdown</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table mat-table [dataSource]="getCurrentData()" class="trip-count-table">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>{{ selectedView === 'vehicle' ? 'Vehicle' : 'Client' }}</th>
              <td mat-cell *matCellDef="let element">{{ element.name }}</td>
            </ng-container>

            <ng-container matColumnDef="count">
              <th mat-header-cell *matHeaderCellDef>Trip Count</th>
              <td mat-cell *matCellDef="let element">
                <div class="count-cell">
                  <span class="count-value">{{ element.count }}</span>
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="element.percentage"></div>
                  </div>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="revenue">
              <th mat-header-cell *matHeaderCellDef>Revenue</th>
              <td mat-cell *matCellDef="let element">{{ element.revenue | currencyFormat }}</td>
            </ng-container>

            <ng-container matColumnDef="percentage">
              <th mat-header-cell *matHeaderCellDef>Percentage</th>
              <td mat-cell *matCellDef="let element">
                <mat-chip class="percentage-chip">{{ element.percentage }}%</mat-chip>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['name', 'count', 'revenue', 'percentage']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['name', 'count', 'revenue', 'percentage'];"></tr>
          </table>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>